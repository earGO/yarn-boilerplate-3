## React Boilerplate для модульного приложения

Модульность реализована через Yarn Workspaces (https://yarnpkg.com/blog/2017/08/02/introducing-workspaces/)

Storybook расположена в packages/storybook

Приложение находится в папке /packages/apps/app-one. 

#### Скрипты и начало работы
- `yarn build` - билдит все пакеты, кроме центрального приложения, для того, чтобы их импорты в другие пакеты были возможны
- `yarn bootstrap` - устанавливает все зависимости всех пакетов в общий node-modules, локальные зависимости пакетов устанавливаются в локальные node-modules. 
- `yarn gulp` - запускает вотчер gulp на все модули, кроме центрального приложения, чтобы ребилдить их при внесении изменений.
- `yarn dev` - поднимает storybook на порту 5555.
- `yarn unit` - Запускает тесты по всем пакетам в режиме --watchAll.
- `yarn start-app` - запускает центральное приложение на порту 3000 в режиме hot-reload
- `yarn test-app` - запускает все тесты центрального приложения в режиме --watch

    "deploy": "FORCE_COLOR=true lerna run deploy",
    "precommit": "lint-staged",
    "storybook": "cd packages/storybook && start-storybook -p 9009 -s public",
    "build-storybook": "lerna exec --scope library-name -- babel src -d dist --copy-files --ignore \"src/stories/\"",
    "watch-storybook": "lerna exec --scope library-name -- babel src -d dist --watch --copy-files --ignore \"src/stories/\"",
    "start-app1": "cd packages/apps/app-one && set PORT=3472 && react-scripts start",
    "start-front": "cd packages/apps/box-frontend && set PORT=1488 && react-scripts start"

После установки репозитория для начала работы нужно выполнить скрипты именно в такой последовательности
- `yarn`
- `yarn bootstrap`
- `yarn build`
- `yarn gulp`
- `yarn start-app`

#### Mock api
До наличия бэкенда и endpoints модули используют mock api через json-server. Json-server необходимо установить глобально. После чего перед запуском приложения необходимо зайти в папку .mock и в ней выполнить `json-server <somefile.json>`

Установятся все зависимости (lerna в частности), после этого установятся все локальные зависимости и связи между ними, после этого создадутся локальные сборки, запустится вотчер изменений пакетов, и поднимется центральное приложение на порту 3000 в режиме мониторинга изменений.


Все модули собираются в приложении, и указываются в его package.json как зависимости по шаблону
 
    `"@project/modules-folder-name": modules-version`
    
Чтобы приложение "видело" папки с модулями, их нужно указать в корневом packaje.json:
```
"workspaces": {    
    "packages": [
      "packages/apps/*",
      "packages/components",
      "packages/storybook",
      "packages/widgets",
      "packages/utils",
      "packages/styled",
      "packages/services",
      "packages/modules"
    ],
    //другие настройки worspaces
  },
```

Зависимости общего типа, такие как React, React-DOM, Redux, Redux-Saga каждого модуля и компонента, импортируемого из внешних папок, должны быть указаны как peerDependency. Индивидуальные зависимости, уникальные для модуля, вносятся в локальный package.json папки, в которой он находится, при помощи обычного yarn add, выполненного локально в папке пакета (например, локальная зависимость `redux-dynamic-modules` для виджета weather).

Локальные зависимости модулей при выполнении yarn будут установлены в общую node_modules

Когда репозиторий склонирован в первый раз, из корня выполнить yarn для установки всех зависимостей. Зависимости буду все установлены в корневом node_modules. Если какой-то пакет нуждается в версии зависимости, отличной от указанных в других пакетах, она установится локально в его папке (типа `babel-loader` у Storybook).
  
Модуль в приложении импортируется как из любой внешней зависимости, взятой из NPM-репозитория:
```
import {Weather} from '@project/widgets';
```

Никаких дополнительных настроек сборщика не требуется.

Приложение запускается командой yarn start из папки приложения

### Если проблемы с запуском
Если приложение не запускается из-за конфликтующих пакетов, добавьте в корень приложения файл .env со следующей строкой:
```
SKIP_PREFLIGHT_CHECK=true
```
без кавычек и прочего. Если не помогает - делайте Issue.

### Создание нового пакета
Новый пакет создаётся в папке packages. Он должен иметь следующую структуру:

```
root
|
|_packages
    |
    |__new-module-folder
              |
              |__src
              |   |_subfolders+_tests_ для каждого subfolder
              |__index.js
              |__import.js
              |__package.json                            
    
 ```
 
 -`index.js` - единая точка экспорта из пакета. Другие пакеты, как и центральное приложение, будут ссылаться на экспорты из этого файла.
 -`imports.js` - единая точка импорта в пакет компонентов из других пакетов. Все внутренние импорты файлов из папки `src` должны ссылаться только на этот файл.
 - `src` - все файлы пакета, организованные по папкам. Например, в пакете `components` папки "common","main" и т.п.
 - `package.json` - конфигурация и зависимости пакета. Конфигуация должна соблюдать формат:
 
 ```{
    "name": "@project/name-of-module",
    "version": "1.0.0",
    "description": "описание модуля",
    "main": "src/index.js", // не менять
    "main:src": "src/index.js",  // не менять
    "license": "MIT", // чтобы не было предупреждений об отсутствии лицензии
        //зависимости модуля
     "dependencies": {
      "@project/components": "1.0.0", //так выглядят импорты из других пакетов монорепозитория
      "@project/services": "1.0.0", //так выглядят импорты из других пакетов монорепозитория
      "ramda": "^0.26.1",
      "throttle-debounce": "^2.1.0"
    },
    //зависимости модуля для тестирования и отладки
    "devDependencies": {
      "fetch-mock": "^7.3.3"
    }
  }
  ``` 
  
  По возможности стоит стремиться использовать peerDependencies вместо локальных зависимостей в случае написания нового модуля в уже существующем проекте. 
  
  Каждый раз, как вы создаете какой-либо пакет и добавляете его в другой пакет в пределах репозитория, нужно выполнять `yarn` из любого места в монорепозитории, чтобы пакет и ссылки на него были зарегистрированы в workspaces. Yarn автоматически перепроверяет и перерегистрирует все ссылки на пакеты в пределах репозитория при каждой установке зависимостей. 
  
 ### Тестирование
 